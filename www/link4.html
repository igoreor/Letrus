<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags-->
    <meta charset="utf-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- Color theme for statusbar (Android only) -->
    <meta name="theme-color" content="#2196f3">
    <!-- Your app title -->
    <title>My App</title>
    <!-- Path to Framework7 Library Bundle CSS -->
    <link rel="stylesheet" href="lib/framework7-bundle.min.css">
    <!-- CSS PERSONALIZADO PARA MENU-->
    <link rel="stylesheet" href="css/home.css">
    <!--Ícones Material Design-->
    <link rel="stylesheet" href="css/materialdesignicons.min.css">
    <!-- Estilo para tela de perfil -->
    <link rel="stylesheet" href="css/profile.css">
    <link rel=" stylesheet" href = "css/ocr.css">

</head>

<body>
    <!-- App root element -->
    <div id="app">
        <div data-name="link4" class="page">

            <!-- Your main view, should have "view-main" class -->
            <div class="container">
                <h2>Teste OCR com Google Vision</h2>
                <input type="file" id="imageInput" accept="image/*" onchange="previewImage()">
                <button onclick="uploadImage()">Enviar Imagem</button>
                <div id="loading" class="loading">Processando imagem...</div>
                <img id="imagePreview" class="image-preview" style="display: none;">
                <div id="result" class="result"></div>
                <button onclick="readText()" style="margin-top: 10px;">Ler em Áudio</button>
            </div>
        </div>
    </div>
    <script>
        // Função para exibir a pré-visualização da imagem
        function previewImage() {
            const fileInput = document.getElementById('imageInput');
            const file = fileInput.files[0];
            const imagePreview = document.getElementById('imagePreview');

            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    imagePreview.style.display = 'block';
                    imagePreview.src = event.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                imagePreview.style.display = 'none';
            }
        }

        // Função para enviar a imagem e realizar o OCR
        async function uploadImage() {
            const fileInput = document.getElementById('imageInput');
            const file = fileInput.files[0];

            if (!file) {
                alert("Por favor, selecione uma imagem.");
                return;
            }

            const formData = new FormData();
            formData.append("file", file);

            // Exibe o loading enquanto aguarda a resposta
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').textContent = ''; // Limpa o resultado anterior

            try {
                const response = await fetch('http://localhost:8090/api/ocr/detect-text', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Erro ao fazer requisição OCR');
                }

                const data = await response.text();
                document.getElementById('result').textContent = data || "Nenhum texto detectado.";
            } catch (error) {
                console.error(error);
                document.getElementById('result').textContent = 'Erro ao processar a imagem.';
            } finally {
                document.getElementById('loading').style.display = 'none'; // Oculta o loading após a resposta
            }
        }

        // Função para ler o texto em áudio
        function readText() {
            const text = document.getElementById('result').textContent;

            if (text) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'pt-BR'; // Define o idioma para português do Brasil
                window.speechSynthesis.speak(utterance);
            } else {
                alert("Nenhum texto para ler.");
            }
        }
    </script>
    <!-- Path to Framework7 Library Bundle JS-->
    <script type="text/javascript" src="lib/framework7-bundle.min.js"></script>
	<!-- jQuery -->
	<script type="text/javascript" src="lib/jquery-3.7.0.min.js"></script>	
    <!-- Roteamento do app-->
    <script type="text/javascript" src="js/routes.js"></script>
    <script src="cordova.js"></script>
</body>

</html>
